<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>WebSocket</title>

    <style>
        html, body {
            font: normal 0.9em arial, helvetica;
        }

        #log2 {
            width: 600px;
            height: 400px;
            border: 1px solid #7F9DB9;
            overflow: auto;
        }

        #app1 {
            width: 400px;
        }
    </style>

    <script>
       window.onbeforeunload = function () {
        try {
            socket.send('quit');
            socket.close();
            socket = null;
            }
        catch (ex) {
            log(ex);
            }
        };

        function init() {
            var form1 = document.getElementById("form1")
            var log1 = document.getElementById("log1")
            var p1 = document.getElementById("p1")
            var start1 = document.getElementById("start1")
            var close1 = document.getElementById("close1")
            var flush1 = document.getElementById("flush1")

            start1.innerHTML='开始'
            flush1.style.display = 'none'
            p1.innerHTML = ''

            var host = "ws://192.168.1.11:88/";
            try {
                socket = new WebSocket(host);
                socket.onopen = function (msg) {
                    ;
                };
                socket.onmessage = function (msg) {
                    log(msg.data);
                    if(msg.data=="SUCCESS!"){start1.innerHTML='开始'}
                };
                socket.onclose = function (msg) {
                    log("Lose Connection!");
                };
            }
            catch (ex) {
                log(ex);
            }
        }


        function begin(obj){
            if (socket==null){init() ; close1.style.display='inline';return};
            app_name = form1.app.value
            selecct_option = form1.option.value
            if (!app_name) {
                alert("Message can not be empty");
                return;
            }
            else{obj.innerHTML='Running';log1.innerHTML = '' ;
                flush1.style.display = 'inline'
                p1.innerHTML= selecct_option + ':' + app_name
                p1.style.color="blue"
                send()}
        }

        function mymessage() {
            alert("加载完成。");
        }

        function send() {
            msg = app_name + ' ' + selecct_option
            try {
                socket.send(msg);
            } catch (ex) {
                log(ex);
            }
        }

        function log(msg) {
//            log1.innerHTML += "<br>" + msg;
            log1.innerHTML +="<br>" + msg
        }

        function clost_websocket() {
            socket.send('quit');
            socket.close();
            socket = null;
            p1.innerHTML = '连接已经断开！ 点击<连接服务器>可重新建立连接'
            start1.innerHTML = '连接服务器'
            flush1.style.display='none'
            close1.style.display='none'
        }

        function clear_log(){
            log1.innerHTML = "刷新成功~~"
        }
    </script>

</head>


<body onload="init()">
<h3>WebSocket</h3>
<br><br>
    <form id='form1' name="input">
        <select id="select1" name="option">
            <option value="update">update</option>
            <option value="status" selected="selected">status</option> #默认
            <option value="start">start</option>
            <option value="stop">stop</option>
            <option value="restart">restart</option>
        </select>
        digger-node：
        <input id="app1" type="text" name="app">
        <button id="start1" type="button" onclick="begin(this)">开始</button>
        <button id="close1" type="button" onclick="clost_websocket()">关闭</button>
        <button id="flush1" type="button" onclick="clear_log()">刷新</button>
        <p id="p1"></p>
    </form>

<fieldset id="log1"></fieldset>

</body>
</html>